---
import Layout from "../layouts/Layout.astro";
import Post from "../Components/Post.astro";

const posts = [
  {
    username: "ひろ@C103/1日目東モ08a",
    accountName: "habanero_mgmg",
    avatarUrl:
      "https://pbs.twimg.com/profile_images/1350790885244485633/5DYTStYq_400x400.jpg",
    // postImgUrl: "https://pbs.twimg.com/media/GPJAr8SbkAAk8o1?format=jpg&name=large",
    postImgUrl:
      "https://pbs.twimg.com/media/GPNxHcsacAAficI?format=jpg&name=900x900",
    repliesCount: 18,
    repostsCount: 4219,
    likesCount: 29415,
    analiticsCount: 368193,
    contentPost: "ヴェールヌイ",
  },
  {
    username: "さ",
    accountName: "iorikawawa",
    avatarUrl:
      "https://pbs.twimg.com/profile_images/1691080601955385344/tuAfJ3Qy_400x400.jpg",
    // postImgUrl:"https://pbs.twimg.com/media/F0QvSJraEAAe66C?format=jpg&name=4096x4096",
    postImgUrl:
      "https://pbs.twimg.com/media/GPJm6jxaoAAdoKr?format=jpg&name=small",
    repliesCount: 7,
    repostsCount: 2217,
    likesCount: 13612,
    analiticsCount: 292461,
    contentPost: "ヴェールヌイ",
  },
  {
    username: "Randomuser",
    accountName: "randomuser",
    avatarUrl: "https://avatars.githubusercontent.com/u/153887376?v=4",
    postImgUrl:
      "https://i.pinimg.com/736x/39/11/6c/39116c247669762f4ce72be4ce2b862e.jpg",
    repliesCount: 4,
    repostsCount: 812,
    likesCount: 6612,
    analiticsCount: 122461,
    contentPost:
      'This is a simple post <a class="post-link" href="/">#Go to home</a>',
  },
];
---

<Layout title="Twitter" favicon="/ico/twitter.ico">
  <main>
    {
      posts.map((post) => (
        <Post
          username={post.username}
          accountName={post.accountName}
          avatarUrl={post.avatarUrl}
          postImgUrl={post.postImgUrl}
          repliesCount={post.repliesCount}
          repostsCount={post.repostsCount}
          likesCount={post.likesCount}
          analiticsCount={post.analiticsCount}
          set:html={post.contentPost}
        />
      ))
    }
  </main>
  <div class="layers">
    <div id="post-viewer"></div>
  </div>

  <script is:inline type="module">
    const appendHTML = ({ parentElement, htmlContent }) => {
      parentElement.innerHTML += htmlContent;
    };

    const removeElement = ({ elementId }) => {
      // const $element = document.getElementById(elementId);
      const $element = document.querySelector(elementId);

      if ($element !== null) {
        // $element.remove();
        $element.remove();
        return;
      }

      console.log("element not found");
    };

    const $postsImages = document.querySelectorAll(".post__image-container");
    const $postViewer = document.querySelector("#post-viewer");

    $postsImages.forEach(($postImage) => {
      $postImage.addEventListener("click", (event) => {
        const $img = event.target.closest("img");

        if ($img instanceof HTMLImageElement) {
          const imgUrl = $img.getAttribute("src");

          appendHTML({
            parentElement: $postViewer,
            htmlContent: ImageViewer({ imgUrl }),
          });
        }
      });
    });

    $postViewer?.addEventListener("click", (event) => {
      if (event.target !== event.target.closest("img")) {
        const elementId = "[data-id=img-viewer]";
        const $element = document.querySelector(elementId);

        $element.classList.toggle("fade-out");

        setTimeout(() => {
          removeElement({ elementId });
        }, 200);
      }
    });

    const ImageViewer = ({ imgUrl }) => {
      return `
        <div class="viewer fade-in" data-id="img-viewer">
          <figure class="viewer__image-container">
            <img
              class="viewer__image"
              src="${imgUrl}"
              alt="anything"
            />
          </figure>
        </div>
      `;
    };
  </script>
</Layout>

<style is:inline>
  body:has([data-id="img-viewer"]) {
    overflow: hidden;
  }

  .viewer {
    position: fixed;
    width: 100dvw;
    height: 100dvh;
    background-color: hsla(0, 0%, 0%, 60%);
    backdrop-filter: blur(5px);
    left: 0;
    top: 0;
  }

  .viewer__image-container {
    height: 100dvh;
    max-width: 95dvw;
    width: 100%;
    overflow-x: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: auto;
  }

  .viewer__image {
    max-height: 95%;
    max-width: 100%;
  }

  .fade-in {
    animation: fade-in;
    animation-duration: 0.2s;
    animation-fill-mode: forwards;
  }

  .fade-out {
    animation: fade-out;
    animation-duration: 0.2s;
    animation-fill-mode: forwards;
  }

  @keyframes fade-in {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes fade-out {
    from {
      opacity: 1;
    }

    to {
      opacity: 0;
    }
  }
</style>

<style>
  html {
    scrollbar-width: thin;
  }

  main {
    padding: 24px;
    background-color: black;
    border-top: 1px solid hsla(0, 0%, 100%, 20%);
  }
</style>
