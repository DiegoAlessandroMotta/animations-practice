---
import Layout from "../layouts/Layout.astro";

const images = [1, 2, 3, 5, 4, 6, 7, 9, 8];
// Array.from({length: 9})
---

<Layout title="Gallery">
  <main class="flex justify-center p-8">
    <section
      class="gallery grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 auto-rows-auto gap-4 max-w-7xl min-w-0 w-full"
    >
      {
        images.map((code) => (
          <picture class="image-container flex overflow-hidden w-full h-full relative rounded-lg
            hover:shadow-md hover:shadow-black transition-shadow duration-500 cursor-pointer">
            <img
              class="grayscale transition-all duration-500 object-cover 
                hover:rotate-[0.5deg] hover:grayscale-0 hover:scale-105"
              src={`/img/${code}.webp`}
              alt={`persona ${code}`}
            />
            <p class="absolute py-1 px-2 text-lg text-white bg-black/50">
              {code}
            </p>
          </picture>
        ))
      }
    </section>
  </main>

  <div class="layers">
    <div id="image-viewer-container"></div>
  </div>
  
  <script is:inline type="module">
    // Gallery page
    const removeElement = ({ selector }) => {
      const $element = document.querySelector(selector);
  
      if ($element !== null) {
        $element.remove();
        return;
      }
  
      console.log(`element "${$element}" not found`);
    };
  
    const images = document.querySelectorAll(".image-container");
    const $imageViewerContainer = document.querySelector(
      "#image-viewer-container",
    );
  
    images.forEach(($imageContainer) => {
      $imageContainer.addEventListener("click", (event) => {
        const $img = event.target.closest("img");
  
        if ($img instanceof HTMLImageElement) {
          const imgUrl = $img.getAttribute("src");
  
          const newImageViewer = ImageViewer({ imgUrl });
  
          $imageViewerContainer.appendChild(newImageViewer);
        }
      });
    });
  
    $imageViewerContainer?.addEventListener("click", (event) => {
      if (event.target !== event.target.closest("img")) {
        const selector = "[data-id=img-viewer]";
        const $element = document.querySelector(selector);
  
        $element.classList.toggle("animate-fade-in");
        $element.classList.toggle("animate-fade-out");
  
        setTimeout(() => {
          removeElement({ selector });
        }, 200);
      }
    });
  
    const ImageViewer = ({ imgUrl }) => {
      const newImageViewer = document.createElement("div");
      const newImageContainer = document.createElement("picture");
      const newImage = document.createElement("img");
  
      newImageViewer.classList.add(
        "fixed",
        "w-dvw",
        "h-dvh",
        "bg-black/50",
        "backdrop-blur",
        "top-0",
        "animate-fade-in",
        "animate-duration-faster",
      );
      newImageViewer.dataset.id = "img-viewer";
  
      newImageContainer.classList.add(
        "w-full",
        "h-full",
        "flex",
        "items-center",
        "justify-center",
      );
  
      newImage.classList.add("object-contain", "max-h-[95dvh]", "max-w-[95dvw]");
      newImage.src = imgUrl;
      newImage.alt = "Anything";
  
      newImageContainer.appendChild(newImage);
      newImageViewer.appendChild(newImageContainer);
  
      return newImageViewer;
    };
  </script>
  
</Layout>

<style>
  .gallery {
    .image-container:nth-child(1),
    .image-container:nth-child(5),
    .image-container:nth-child(9) {
      grid-column: 1;
    }
  }

  @media (min-width: 640px) {
    .gallery {
      .image-container:nth-child(1),
      .image-container:nth-child(5),
      .image-container:nth-child(9) {
        grid-column: span 2;
      }
    }
  }
</style>
